# CLAUDE.md

## 目的
このドキュメントは、Claude Code の作業方針とプロジェクト固有のルールを示します。

## 判断記録のルール
- 判断内容の要約
- 検討した代替案
- 採用しなかった案とその理由
- 前提条件・仮定・不確実性
- 他エージェントによるレビュー可否

## プロジェクト概要
- 目的: pixiv のブックマークを監視し、新規ブックマークを Discord に通知する
- 主な機能: イラスト・小説のブックマーク監視、Discord 通知、通知済み管理

## 重要ルール
- 会話と言語: 日本語を使用する。
- コード内コメント: 日本語で記載する。
- エラーメッセージ: 英語で記載する。
- コミット規約: Conventional Commits に従う。`<description>` は日本語。
- スペース: 日本語と英数字の間には半角スペースを挿入する。

## 環境のルール
- ブランチ命名: Conventional Branch (`feat/description`, `fix/description`) に従う。
- リポジトリ調査: `search_file_content` や `ls -R` を活用して構造を理解する。
- Renovate: Renovate が作成した PR に対しては追加コミットを行わない。

## コード改修時のルール
- エラーメッセージの絵文字: 既存のメッセージに合わせて適切な絵文字を先頭に付与する。
- TypeScript: `skipLibCheck: true` による型チェック回避は禁止。
- docstring: 関数・インターフェースに日本語で JSDoc を記載する。

## 相談ルール
- Codex CLI: 実装レビュー、局所設計、整合性確認に使用する。
- Gemini CLI: 外部仕様、最新情報確認に使用する。
- 指摘への対応: 指摘事項は無視せず、適切に対応または理由を説明する。

## 開発コマンド
```bash
# インストール
pnpm install

# 実行
pnpm start

# 開発
pnpm dev

# テスト
pnpm test

# Lint / Format
pnpm lint
pnpm fix
```

## アーキテクチャと主要ファイル
- `src/main.ts`: メインロジック（pixiv 取得、通知ループ）
- `src/notified.ts`: 通知済みアイテムの永続化管理
- `data/`: トークンや通知済みリストの保存先（.gitignore 指定）

## テスト
- テストフレームワーク: Jest
- 方針: 重要なロジック（通知判定など）に対してテストを作成する。

## 作業チェックリスト

### 新規改修時
1. プロジェクト構造と `package.json` を理解する
2. 適切な `feat/` または `fix/` ブランチを作成する
3. 最新の `master` ブランチに基づいているか確認する

### コミット・プッシュ前
1. Conventional Commits 形式を確認する
2. 機密情報（トークン等）が含まれていないか確認する
3. `pnpm lint` でエラーがないことを確認する
4. 動作確認を行う

### PR 作成前
1. ユーザーの依頼があることを確認する
2. コンフリクトの可能性を確認する

### PR 作成後
1. `gh pr checks` で CI の成功を確認する
2. GitHub Copilot / Codex のレビューに対応する

## リポジトリ固有
- `@book000/pixivts` を使用して pixiv API と通信している。
- 通知済み管理は単純な JSON ファイルで行われている。
